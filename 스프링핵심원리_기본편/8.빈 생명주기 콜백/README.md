# 빈 생명주기 콜백 시작

## 스프링이 제공하는 초기화 작업과 종료 작업
- 데이터베이스 커넥션 풀, 네트워크 소켓처럼 애플리케이션 시작 시점에 필요한 연결이 있다
- 요청이 올 때, 연결을 하는 것이 아닌 미리 연결을 해두거나 애플리케이션이 종료될 때 모든 연결을 종료하는 작업이 필요하다
- 스프링은 객체의 초기화와 종료 작업에 대해 지원한다

## 스프링 빈 라이프사이클
- `객체 생성` 이후 `의존관계 주입`
- 객체 생성 이후 의존관계 주입이 다 끝난 다음에야 필요한 데이터를 사용할 준비가 된다
- 즉, 초기화 작업은 의존관계 주입이 모두 완료되고 난 이후에 호출해야 한다
- 스프링은 스프링 컨테이너가 종료되기 직전에 소멸 콜백을 주기 때문에 안전하게 종료 작업이 진행된다

### 스프링 빈의 이벤트 라이프 사이클
`스프링 컨테이너 생성` -> `스프링 빈 생성` -> `의존관계 주입` -> `초기화 콜백` -> `사용` -> `소멸 전 콜 백` -> `스프링 종료`

### 참고) 객체의 생성과 초기화를 분리하자
- 단일 책임 원칙에 따라 분리해야 한다
- 생성자는 파라미터를 받고, 메모리를 할당해 객체를 생성하는 책임
- 초기화는 이렇게 생성된 값을 활용해 외부 커넥션을 연결하는 등 무거운 동작을 수행할 책임
- 유지보수 관점에서 명확하게 나누는 것이 좋다

## 스프링은 크게 3가지 방법으로 빈 생명주기 콜백을 지원한다
- 인터페이스(InitializingBean, DisposableBean)
- 설정 정보에 초기화 메서드, 종료 메서드 지정
- @PostConstruct, @PreDestroy 애노테이션


## InitializingBean, DisposableBean
- InitializingBean : `afterPropertiesSet()` 메서드로 초기화를 지원
- DisposableBean : `destroy()` 메서드로 소멸을 지원
- 단점 : 스프링 전용 인터페이스(해당 코드가 스프링 전용 인터페이스에 의존)
- 거의 사용하지 않는 방법

## 빈 등록 초기화, 소멸 메서드
- `@Bean(initMethod = "init", destroyMethod = "close")` 을 이용
- 메서드 이름을 자유롭게 줄 수 있다
- 스프링 빈이 스프링 코드에 의존하지 않는다
- 코드가 아니라 설정 정보를 사용하기 때문에 코드를 고칠 수 없는 외부 라이브러리에도 초기화, 종료 메서드를 적용할 수 있다

## 애노테이션 @PostConstruct, @PreDestory
- 결론부터 이야기하자면, 스프링도 권장하는 방법이고 이 방법을 사용하자
- 애노테이션 하나만 붙이면 된다
- 패키지를 보면, `javax.annotation.PostConstruct`이다. 즉, 스프링에 종속된 기술이 아니라 자바 표준이다
- 컴포넌트 스캔과 잘 어울린다
- 단점 : 외부 라이브러리에 적용할 수 없다(외부 라이브러리를 초기화, 종료해야 하면 @Bean의 기능을 사용하자
